<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>YouTube Archive</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='quick-front.css'>
    <style>
        a {
            text-decoration: none;
            color: inherit;
        }

        .as-button {
            user-select: initial;
        }
    </style>
    <script src='quick-front.js' type="module"></script>
</head>

<body class="as-dark-theme">
    <div class="flex column as-page">
        <h1>
            <a href="/">YouTube Archive</a>
            &nbsp;&gt;&nbsp;
            <template for="$label in [label]">
                <b>
                    $label
                </b>
            </template>
        </h1>
        <template for="$length in [videos.length]">
            <div>$length videos</div>
        </template>
        <div class="flex column border-top mt-2" id="videos"></div>
    </div>

    <script>
        function init() {
            const page = $$VIDEOS$$

            document.title = page.label + " - YouTube Archive"

            /** @type {string[]} */
            const videoListHtml = []

            const videosElement = document.getElementById("videos")

            /** @type {[number, string][]} */
            const labels = page.labels

            let i = 0
            for (const video of page.videos) {
                if (labels.length > 0 && labels[0][0] == i) {
                    const [, text] = labels.shift()
                    const label = document.createElement("h1")
                    label.classList.add("border-bottom")
                    label.innerHTML = escapeHTML(text)
                    videosElement.append(label)
                }

                const anchor = document.createElement("a")
                anchor.href = `/watch?v=${video.id}`
                anchor.setAttribute("class", "as-button flat as-clickable text-left flex row border-bottom gap-2 p-2")
                anchor.innerHTML =/*html*/`
                        <div class="w-200 flex center overflow-hidden" style="aspect-ratio: 1.8021265093;">
                            <img src="${video.thumbnail}" class="w-fill">
                        </div>
                        <div class="flex column gap-2">
                            <div class="flex-wrap">
                                ${video.id == null ? /*html*/`<div class="text-danger">(Missing)</div>` : ""}
                                <b>${video.label}</b>
                                ${video.id != null ? /*html*/`<a href="https://www.youtube.com/watch?v=${video.id}" class="muted">[${i++}]</a>` : ""}
                                ${video.captions.map(caption => (
                                    /*html*/`<small class="bg-primary-transparent small px-1 rounded">${caption}</small>`
                )).join("\n")}
                            </div>
                            <div class="small muted">
                                ${video.channelId != null && video.channel != null ? (
                                    /*html*/`<a href="https://www.youtube.com/channel/${video.channelId}">${video.channel}</a>`
                    ) : (
                                    /*html*/`<span class="text-danger">Unknown</span>`
                    )}
                            </div>
                            <div class="small muted">
                                <time datetime="${video.publishedAt}" title="${video.publishedAt}">${video.publishedAgo}</time>
                            </div>
                        </div>
                `

                videosElement.append(anchor)
            }


            startApp({ ...page })
        }
    </script>
</body>

</html>
